<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPOIRD TACTICAL ANALYZER PRO</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg: #0b0f19;
            --card: #161e2d;
            --accent: #00f2ff;
            --text: #e2e8f0;
            --win: #10b981;
            --loss: #f43f5e;
            --gray: #64748b;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- HEADER: TIMER & POSSESSO --- */
        .header-box { 
            background: var(--card); 
            border-radius: 15px; 
            padding: 20px; 
            border: 1px solid var(--gray); 
            margin-bottom: 10px; 
            text-align: center; 
        }
        #timer-display { 
            font-size: 3rem; 
            font-weight: 900; 
            font-variant-numeric: tabular-nums; 
            color: white; 
            margin-bottom: 15px; 
            display: block; 
        }
        .possession-container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin-bottom: 15px; 
        }
        .pos-btn { 
            padding: 20px; 
            border: none; 
            border-radius: 12px; 
            color: white; 
            font-weight: 800; 
            opacity: 0.2; 
            transition: 0.3s; 
            font-size: 1.1rem;
        }
        .pos-btn.active { 
            opacity: 1; 
            box-shadow: 0 0 25px var(--accent); 
            transform: scale(1.05); 
        }
        .control-btns {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .btn-main-sm {
            background: transparent;
            border: 1px solid var(--gray);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* --- DASHBOARD: xG COUNTERS --- */
        .kpi-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .kpi-card {
            background: var(--card);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #2d3748;
        }
        .kpi-label { font-size: 0.7rem; color: var(--gray); text-transform: uppercase; margin-bottom: 5px; display: block; }
        .kpi-value { font-size: 1.8rem; font-weight: 900; color: var(--accent); }

        /* --- GRID: MACROCATEGORIE --- */
        .section-title { 
            font-size: 0.8rem; 
            color: var(--accent); 
            font-weight: 900; 
            margin: 15px 0 10px 5px; 
            text-transform: uppercase; 
            letter-spacing: 1.5px;
        }
        .matrix { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-bottom: 15px; 
        }
        .macro-btn {
            background: var(--card);
            border: 1px solid #2d3748;
            border-radius: 18px;
            padding: 30px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .macro-btn:active { transform: scale(0.95); background: #1e293b; }
        .macro-title { font-weight: 900; font-size: 0.85rem; color: #fff; line-height: 1.2; }
        .macro-count { font-size: 0.65rem; color: var(--gray); margin-top: 8px; font-weight: bold; }

        /* --- MODAL SYSTEM --- */
        #modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 1000;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .modal-title {
            color: var(--accent);
            font-size: 1.4rem;
            font-weight: 900;
            text-transform: uppercase;
        }
        .micro-group {
            background: #1e293b;
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 5px solid var(--accent);
        }
        .micro-label {
            display: block;
            font-size: 0.95rem;
            font-weight: 800;
            margin-bottom: 12px;
            color: #fff;
        }
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .btn-action {
            flex: 1;
            min-width: 100px;
            padding: 16px 10px;
            border: none;
            border-radius: 10px;
            background: #334155;
            color: white;
            font-size: 0.8rem;
            font-weight: 800;
            text-transform: uppercase;
        }
        .btn-action:active { background: var(--accent); color: #000; }
        .btn-close {
            background: var(--loss);
            color: white;
            padding: 20px;
            border-radius: 15px;
            border: none;
            font-weight: 900;
            font-size: 1rem;
            margin-top: 20px;
            width: 100%;
        }

        /* --- FOOTER: NOTES & REPORT --- */
        .notes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        textarea { 
            background: #0f172a; border: 1px solid #334155; border-radius: 12px; 
            color: white; padding: 12px; font-size: 0.85rem; height: 100px; resize: none;
        }
        .report-btn {
            background: var(--accent);
            color: black;
            padding: 22px;
            border-radius: 18px;
            border: none;
            font-weight: 900;
            font-size: 1.2rem;
            margin-bottom: 40px;
        }
        #chart-wrapper {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 50px;
        }
    </style>
</head>
<body>

    <div class="header-box">
        <span id="timer-display">00:00</span>
        <div class="possession-container">
            <button id="posA" class="pos-btn" style="background: var(--win)" onclick="togglePossession('A')">NOI: <span id="percA">50%</span></button>
            <button id="posB" class="pos-btn" style="background: var(--loss)" onclick="togglePossession('B')">LORO: <span id="percB">50%</span></button>
        </div>
        <div class="control-btns">
            <button id="startStopBtn" class="btn-main-sm" onclick="startStopTimer()">AVVIA MATCH</button>
            <button class="btn-main-sm" onclick="resetAll()">RESET</button>
        </div>
    </div>

    <div class="kpi-container">
        <div class="kpi-card">
            <span class="kpi-label">xG Prodotti (Noi)</span>
            <span class="kpi-value" id="xg-prod">0.00</span>
        </div>
        <div class="kpi-card">
            <span class="kpi-label">xG Concessi (Loro)</span>
            <span class="kpi-value" id="xg-conc">0.00</span>
        </div>
    </div>

    <div class="section-title">Macro Categorie Analisi</div>
    <div class="matrix">
        <div class="macro-btn" onclick="openMacro('FINALIZZAZIONE')">
            <span class="macro-title">FINALIZZAZIONE</span>
            <span class="macro-count" id="count-FINALIZZAZIONE">Eventi: 0</span>
        </div>
        <div class="macro-btn" onclick="openMacro('PALLA INATTIVA')">
            <span class="macro-title">PALLA INATTIVA</span>
            <span class="macro-count" id="count-PALLA-INATTIVA">Eventi: 0</span>
        </div>
        <div class="macro-btn" onclick="openMacro('TRANSIZIONI OFFENSIVE')">
            <span class="macro-title">TRANSIZIONI OFFENSIVE</span>
            <span class="macro-count" id="count-TRANSIZIONI-OFFENSIVE">Eventi: 0</span>
        </div>
        <div class="macro-btn" onclick="openMacro('CONTRASTO E RECUPERO')">
            <span class="macro-title">CONTRASTO E RECUPERO</span>
            <span class="macro-count" id="count-CONTRASTO-E-RECUPERO">Eventi: 0</span>
        </div>
        <div class="macro-btn" onclick="openMacro('PROGRESSIONE')">
            <span class="macro-title">PROGRESSIONE</span>
            <span class="macro-count" id="count-PROGRESSIONE">Eventi: 0</span>
        </div>
        <div class="macro-btn" onclick="openMacro('TRANSIZIONI DIFENSIVE')">
            <span class="macro-title">TRANSIZIONI DIFENSIVE</span>
            <span class="macro-count" id="count-TRANSIZIONI-DIFENSIVE">Eventi: 0</span>
        </div>
    </div>

    <div class="section-title">Note Tattiche Live</div>
    <div class="notes-grid">
        <textarea placeholder="Analisi Offensiva..."></textarea>
        <textarea placeholder="Analisi Difensiva..."></textarea>
    </div>

    <button class="report-btn" onclick="generateReport()">GENERA REPORT FINALE</button>

    <div id="chart-wrapper">
        <canvas id="radarChart"></canvas>
    </div>

    <div id="modal-overlay">
        <div class="modal-header">
            <h2 id="modal-title" class="modal-title"></h2>
        </div>
        <div id="modal-content">
            </div>
        <button class="btn-close" onclick="closeModal()">CHIUDI E TORNA AL MATCH</button>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let matchSeconds = 0;
        let timeNoi = 0;
        let timeLoro = 0;
        let isTimerActive = false;
        let currentPossession = null;
        let timerInterval = null;

        let stats = {
            xgNoi: 0.0,
            xgLoro: 0.0,
            counts: {
                "FINALIZZAZIONE": 0,
                "PALLA INATTIVA": 0,
                "TRANSIZIONI OFFENSIVE": 0,
                "CONTRASTO E RECUPERO": 0,
                "PROGRESSIONE": 0,
                "TRANSIZIONI DIFENSIVE": 0
            }
        };

        // --- TIMER & POSSESSION LOGIC ---
        function startStopTimer() {
            if (!isTimerActive) {
                isTimerActive = true;
                document.getElementById('startStopBtn').innerText = "PAUSA MATCH";
                timerInterval = setInterval(() => {
                    matchSeconds++;
                    if (currentPossession === 'A') timeNoi++;
                    if (currentPossession === 'B') timeLoro++;
                    updateTimerDisplay();
                }, 1000);
            } else {
                isTimerActive = false;
                document.getElementById('startStopBtn').innerText = "RIPRENDI MATCH";
                clearInterval(timerInterval);
            }
        }

        function togglePossession(team) {
            currentPossession = team;
            document.getElementById('posA').classList.toggle('active', team === 'A');
            document.getElementById('posB').classList.toggle('active', team === 'B');
        }

        function updateTimerDisplay() {
            const mins = Math.floor(matchSeconds / 60).toString().padStart(2, '0');
            const secs = (matchSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${mins}:${secs}`;

            const totalPosTime = timeNoi + timeLoro || 1;
            document.getElementById('percA').innerText = Math.round((timeNoi / totalPosTime) * 100) + '%';
            document.getElementById('percB').innerText = Math.round((timeLoro / totalPosTime) * 100) + '%';
        }

        // --- MODAL & MICRO LOGIC ---
        function openMacro(macroName) {
            const overlay = document.getElementById('modal-overlay');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.innerText = macroName;
            content.innerHTML = ''; // Clear previous
            
            // --- LOGICA ESPLICITA PER OGNI CATEGORIA ---

            if (macroName === 'FINALIZZAZIONE') {
                content.innerHTML = `
                    <div class="micro-group">
                        <span class="micro-label">TIRI TOTALI (NOI)</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="addShot('NOI', 0.15, 'Porta')">In Porta (0.15)</button>
                            <button class="btn-action" onclick="addShot('NOI', 0.05, 'Fuori')">Fuori (0.05)</button>
                            <button class="btn-action" onclick="addShot('NOI', 0.03, 'Bloccato')">Bloccato</button>
                        </div>
                    </div>
                    <div class="micro-group">
                        <span class="micro-label">TIRI TOTALI (LORO)</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="addShot('LORO', 0.15, 'Porta')">In Porta</button>
                            <button class="btn-action" onclick="addShot('LORO', 0.05, 'Fuori')">Fuori</button>
                        </div>
                    </div>
                    <div class="micro-group">
                        <span class="micro-label">POSIZIONE TIRO (CALCOLO xG AGGIUNTIVO)</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="addXG('NOI', 0.30)">Area Centrale (+0.3)</button>
                            <button class="btn-action" onclick="addXG('NOI', 0.05)">Fuori Area (+0.05)</button>
                        </div>
                    </div>
                    <div class="micro-group">
                        <span class="micro-label">ESITO E QUALITÀ</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('FINALIZZAZIONE')">GOL SEGNATO</button>
                            <button class="btn-action" onclick="logEvent('FINALIZZAZIONE')">ASSIST</button>
                            <button class="btn-action" onclick="logEvent('FINALIZZAZIONE')">CROSS RIUSCITO</button>
                            <button class="btn-action" onclick="logEvent('FINALIZZAZIONE')">CROSS TENTATO</button>
                        </div>
                    </div>
                `;
            }

            if (macroName === 'PALLA INATTIVA') {
                content.innerHTML = `
                    <div class="micro-group">
                        <span class="micro-label">CALCI D'ANGOLO</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('PALLA INATTIVA')">CORNER A FAVORE</button>
                            <button class="btn-action" onclick="logEvent('PALLA INATTIVA')">CORNER CONTRO</button>
                        </div>
                    </div>
                    <div class="micro-group">
                        <span class="micro-label">PUNIZIONI E TIRI</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('PALLA INATTIVA')">PUNIZIONE PERICOLOSA</button>
                            <button class="btn-action" onclick="addXG('NOI', 0.10)">TIRO DA PIAZZATO</button>
                            <button class="btn-action" onclick="logEvent('PALLA INATTIVA')">GOL DA PIAZZATO</button>
                        </div>
                    </div>
                `;
            }

            if (macroName === 'TRANSIZIONI OFFENSIVE') {
                content.innerHTML = `
                    <div class="micro-group">
                        <span class="micro-label">AZIONI DI RIPARTENZA</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('TRANSIZIONI OFFENSIVE')">CONTROPIEDE CONCLUSO</button>
                            <button class="btn-action" onclick="logEvent('TRANSIZIONI OFFENSIVE')">ATTACCO DIRETTO</button>
                        </div>
                    </div>
                `;
            }

            if (macroName === 'CONTRASTO E RECUPERO') {
                content.innerHTML = `
                    <div class="micro-group">
                        <span class="micro-label">DIFESA ATTIVA</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('CONTRASTO E RECUPERO')">CONTRASTO VINTO</button>
                            <button class="btn-action" onclick="logEvent('CONTRASTO E RECUPERO')">CONTRASTO TENTATO</button>
                            <button class="btn-action" onclick="logEvent('CONTRASTO E RECUPERO')">INTERCETTAZIONE</button>
                            <button class="btn-action" onclick="logEvent('CONTRASTO E RECUPERO')">DUELLO AEREO VINTO</button>
                        </div>
                    </div>
                `;
            }

            if (macroName === 'PROGRESSIONE') {
                content.innerHTML = `
                    <div class="micro-group">
                        <span class="micro-label">MANOVRA AVANZATA</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('PROGRESSIONE')">DRIBBLING RIUSCITO</button>
                            <button class="btn-action" onclick="logEvent('PROGRESSIONE')">DRIBBLING TENTATO</button>
                            <button class="btn-action" onclick="logEvent('PROGRESSIONE')">PASSAGGIO IN PROFONDITÀ</button>
                        </div>
                    </div>
                `;
            }

            if (macroName === 'TRANSIZIONI DIFENSIVE') {
                content.innerHTML = `
                    <div class="micro-group">
                        <span class="micro-label">PERICOLI SUBITI</span>
                        <div class="btn-row">
                            <button class="btn-action" onclick="logEvent('TRANSIZIONI DIFENSIVE')">CONTROPIEDE SUBITO</button>
                            <button class="btn-action" onclick="logEvent('TRANSIZIONI DIFENSIVE')">PERDITA PALLA PERICOLOSA</button>
                            <button class="btn-action" onclick="logEvent('TRANSIZIONI DIFENSIVE')">FALLO TATTICO</button>
                        </div>
                    </div>
                `;
            }

            overlay.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

        // --- STATS LOGIC ---
        function addShot(team, val, label) {
            if (team === 'NOI') stats.xgNoi += val;
            else stats.xgLoro += val;
            logEvent('FINALIZZAZIONE');
            updateKPIs();
        }

        function addXG(team, val) {
            if (team === 'NOI') stats.xgNoi += val;
            else stats.xgLoro += val;
            updateKPIs();
        }

        function logEvent(macro) {
            stats.counts[macro]++;
            const displayMacro = macro.replace(/ /g, '-');
            document.getElementById(`count-${displayMacro}`).innerText = `Eventi: ${stats.counts[macro]}`;
            updateKPIs();
        }

        function updateKPIs() {
            document.getElementById('xg-prod').innerText = stats.xgNoi.toFixed(2);
            document.getElementById('xg-conc').innerText = stats.xgLoro.toFixed(2);
        }

        function resetAll() {
            if(confirm("Vuoi resettare tutti i dati del match?")) {
                location.reload();
            }
        }

        // --- CHARTING ---
        function generateReport() {
            document.getElementById('chart-wrapper').style.display = 'block';
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            const labels = Object.keys(stats.counts);
            const dataValues = Object.values(stats.counts);

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Volume d\'Azione per Macroarea',
                        data: dataValues,
                        backgroundColor: 'rgba(0, 242, 255, 0.2)',
                        borderColor: '#00f2ff',
                        pointBackgroundColor: '#00f2ff',
                        borderWidth: 3
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: '#334155' },
                            grid: { color: '#334155' },
                            pointLabels: { color: '#64748b', font: { size: 10, weight: 'bold' } },
                            beginAtZero: true
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>
</html>
